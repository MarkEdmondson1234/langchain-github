<!doctype html>
<html>
  <head>
    <title>Electric Sheep Brain - ReIndex</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.32.0/js/jquery.fileupload.min.js" crossorigin="anonymous"></script>    

    <style>
        #hidden-repo-input {
          display: none;
        }
        #select-folder-btn {
          cursor: pointer;
        }
      </style>
  </head>
  <body>
    <header>Upload files into Electric Sheep Brain</header>
    <!-- Navigation menu -->
    <nav>
        <ul class="nav">
            <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="reindex">Reindex</a></li>
        </ul>
    </nav>
    <div class="container">
            <div class="col-12">
              <label for="repo" class="form-label">Pick a folder to upload into the index</label>
              <div class="input-group">
                <input type="file" name="repo" id="repo-input" data-url="/process_upload" multiple>
              </div>                          

            <div class="col-12">
                <label for="ext" class="form-label">File extensions to index from within data source</label>
                <input type="text" name="ext" id="ext" class="form-control" value=".py,.md,.txt">
            </div>

            <div class="col-12">
              <div class="form-check">
                  <input type="checkbox" name="resummarise" id="resummarise" class="form-check-input">
                  <label for="resummarise" class="form-check-label">Regenerate summarise.md files (slow)</label>
              </div>
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-primary">Do a Reindex</button>
          </div>
      <div id="loading-message" style="display:none;">
          <img src="{{ url_for('static', filename='loading.gif') }}" alt="Loading..." / width="400">
      </div>
  </div>

  <script>
    // Show loading message
    function showLoadingMessage() {
        const loadingMessage = document.getElementById('loading-message');
        loadingMessage.style.display = 'block';
    }

    // Hide loading message
    function hideLoadingMessage() {
        const loadingMessage = document.getElementById('loading-message');
        loadingMessage.style.display = 'none';
    }

    $(function () {
        $('#repo-input').fileupload({
            dataType: 'json',
            add: function (e, data) {
                showLoadingMessage();
                data.submit();
            },
            done: function (e, data) {
                hideLoadingMessage();

                const outputElement = document.getElementById('output');
                const parsedData = JSON.parse(data.result);
                let htmlContent = `<h2>Index Complete</h2><p>${parsedData.result}</p>`;

                outputElement.innerHTML = htmlContent;
            },
            fail: function (e, data) {
                hideLoadingMessage();
                console.error('Error:', e);
            }
        });
    });
</script>

  </body>
  </html>